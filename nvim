" https://github.com/junegunn/vim-plug
call plug#begin()

Plug 'itchyny/lightline.vim'
Plug 'mhinz/vim-janah'

Plug 'Shougo/deoplete.nvim'

Plug 'scrooloose/syntastic'
Plug 'rking/ag.vim'
Plug 'kien/ctrlp.vim'
Plug 'jonhiggs/vim-readline'
Plug 'junegunn/vim-easy-align'

Plug 'elzr/vim-json'
Plug 'tpope/vim-markdown'
Plug 'chase/vim-ansible-yaml'
Plug 'hashivim/vim-terraform'
Plug 'elixir-lang/vim-elixir'
Plug 'derekwyatt/vim-scala'
Plug 'nathanielc/vim-tickscript'

Plug 'zchee/deoplete-go', { 'do': 'make'}
Plug 'nsf/gocode', { 'rtp': 'nvim', 'do': '~/.config/nvim/plugged/gocode/nvim/symlink.sh' }
Plug 'fatih/vim-go'

call plug#end()

syntax on
set encoding=utf-8
"set t_Co=256

let mapleader=" "
set noswapfile
set undofile
set undodir=~/.config/nvim/undo
set clipboard+=unnamedplus

set autowrite
set completeopt-=preview

set autoread
set hidden
set incsearch
set smartcase
set hlsearch
set softtabstop=2 tabstop=2 shiftwidth=2 expandtab
set conceallevel=0
nnoremap <esc><esc> :nohl<cr>

colorscheme janah

" lightline
set laststatus=2
let g:lightline = {
  \ 'separator': {'left': '', 'right': ''},
  \ 'subseparator': {'left': '·', 'right': '·'}
  \ }

set list " show invisible characters
set listchars=" " reset the listchars
set listchars=tab:\ \ " a tab should display as " "
" show trailing spaces as dots
set listchars+=trail:· 
" the character to show in the last column when wrap is off and the line continues beyond the right of the screen
set listchars+=extends:> 
" the character to show in the first column when wrap is off and the line continues beyond the right of the screen
set listchars+=precedes:<

" fml
command! W w
command! Q q

" indentation in visual mode
vnoremap < <gv
vnoremap > >gv|

" split vertical / horizontal
nnoremap <silent> <C-w>h :split<cr>
nnoremap <silent> <C-w>v :vsp<cr>
" split navigation with arrow keys
nnoremap <silent> <C-k> :wincmd k<cr>
nnoremap <silent> <C-j> :wincmd j<cr>
nnoremap <silent> <C-l> :wincmd l<cr>
nnoremap <silent> <C-h> :wincmd h<cr>

" Make command-window more term-like
cnoremap <C-b> <Left>
cnoremap <C-f> <Right>
cnoremap <M-b> <S-Left>
cnoremap <M-f> <S-Right>

" toggle number/relativenumber
function! NumberToggle()
  if(&relativenumber == 1)
    set number
    set norelativenumber
  elseif (&number == 1)
    set nonumber
    set norelativenumber
  else
    set number
    set relativenumber
  endif
endfunc
nnoremap <C-n> :call NumberToggle()<cr>

" netrw
let g:netrw_liststyle=3

" ctrl-p and ag
let g:ctrlp_working_path_mode = 'ra'
let g:ctrlp_map = '<Leader>p'
nnoremap <Leader>p :CtrlP<cr>
nnoremap <Leader>b :CtrlPBuffer<cr>
nnoremap <Leader>m :CtrlPMRU<cr>

" Start interactive EasyAlign in visual mode (e.g. vipga)
xmap ga <Plug>(EasyAlign)

let g:ag_working_path_mode="r"
nnoremap <Leader>g :Ag 

" setup deoplete
let g:deoplete#enable_at_startup = 1

" setup go
au FileType go nmap <Leader><S-i> <Plug>(go-info)
au FileType go nmap <Leader><S-s> <Plug>(go-implements)
au FileType go nmap <Leader><S-d> <Plug>(go-def)
au FileType go nmap <Leader><S-t> <Plug>(go-test)
au FileType go nmap <Leader><S-c> <Plug>(go-coverage-toggle)
au FileType go nmap <Leader><S-r> <Plug>(go-run)

" run :GoBuild or :GoTestCompile based on the go file
function! s:build_go_files()
  let l:file = expand('%')
  if l:file =~# '^\f\+_test\.go$'
    call go#cmd#Test(0, 1)
  elseif l:file =~# '^\f\+\.go$'
    call go#cmd#Build(0)
  endif
endfunction

"au FileType go nmap <Leader><S-b> <Plug>(go-build)
au FileType go nmap <Leader><S-b> :<C-u>call <SID>build_go_files()<CR>

let g:go_fmt_command = "goimports"
let g:go_list_type = "quickfix"
"let g:go_auto_type_info = 0
let g:go_highlight_functions = 1
let g:go_highlight_methods = 1
let g:go_highlight_fields = 1
let g:go_highlight_types = 1
let g:go_highlight_operators = 1
let g:go_highlight_build_constraints = 1

" ensure filetypes
au BufNewFile,BufReadPost *.md set filetype=markdown conceallevel=2

" override tabs and spaces
au FileType make set softtabstop=4 tabstop=4 shiftwidth=4 noexpandtab
au FileType go   set softtabstop=4 tabstop=4 shiftwidth=4 noexpandtab
